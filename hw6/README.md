## Homework 6

### Задание:
```console
Kafka Connect
Цель:
Научиться разворачивать Kafka Connect и настраивать интеграцию с postgresSQL

Описание/Пошаговая инструкция выполнения домашнего задания:

Развернуть Kafka Connect, настроить интеграцию с PostgreSQL, используя Debezium PostgreSQL CDC Source Connector:
    Запустить Kafka
    Запустить Kafka Connect
    Запустить PostgreSQL
    Создать в PostgreSQL тестовую таблицу
    Создать Debezium PostgreSQL CDC Source Connector
    Добавить записи в таблицу
    Проверить, что записи появились в Kafka
```

### Решение:

#### Список файлов:
```console
├── debezium
│   └── connector.json
├── docker
│   ├── docker-compose.yml
│   └── postgres
│       └── initTable.sql
├── example
│   └── out.json
├── images
│   ├── kafdrop_1.png
│   ├── kafdrop_2.png
│   └── kafdrop_3.png
├── Makefile
└── README.md
```

#### Используя наработки из предыдущих ДЗ, составим наш "docker-compose.yml" для старта всех необходимых компонентов.
  Для удобства будем использовать "Makefile", в котором пропишем все шаги данного ДЗ.


#### 1. Создаем все необходимые компоненты:
```console
# make up

docker-compose -f ./docker/docker-compose.yml up -d
Creating network "docker_default" with the default driver
Creating volume "docker_kafka1-data" with default driver
Creating volume "docker_kafka2-data" with default driver
Creating volume "docker_kafka3-data" with default driver
Creating volume "docker_postgres-data" with default driver
Creating postgres ... done
Creating kafka2   ... done
Creating kafka3   ... done
Creating kafka1   ... done
Creating kafdrop  ... done
Creating debezium ... done
Creating debezium-ui ... done

# docker ps 
CONTAINER ID   IMAGE                            COMMAND                  CREATED          STATUS                    PORTS                                                           NAMES
6e3a4ef5f5db   debezium/debezium-ui:2.5         "/deployments/run-ja…"   4 seconds ago    Up 3 seconds              0.0.0.0:8080->8080/tcp, :::8080->8080/tcp                       debezium-ui
1306e0ffad37   debezium/connect:2.5             "/docker-entrypoint.…"   15 seconds ago   Up 14 seconds (healthy)   8778/tcp, 0.0.0.0:8083->8083/tcp, :::8083->8083/tcp, 9092/tcp   debezium
442dce23d78e   obsidiandynamics/kafdrop:4.0.1   "/kafdrop.sh"            25 seconds ago   Up 24 seconds             0.0.0.0:9000->9000/tcp, :::9000->9000/tcp                       kafdrop
0b6bace9ca23   confluentinc/cp-kafka:7.5.3      "/etc/confluent/dock…"   26 seconds ago   Up 24 seconds             9092/tcp, 0.0.0.0:39091->39091/tcp, :::39091->39091/tcp         kafka1
d2ea68fc054a   confluentinc/cp-kafka:7.5.3      "/etc/confluent/dock…"   26 seconds ago   Up 24 seconds             9092/tcp, 0.0.0.0:39093->39093/tcp, :::39093->39093/tcp         kafka3
6665a0207304   confluentinc/cp-kafka:7.5.3      "/etc/confluent/dock…"   26 seconds ago   Up 24 seconds             9092/tcp, 0.0.0.0:39092->39092/tcp, :::39092->39092/tcp         kafka2
c700d4e9d431   postgres:16.3                    "docker-entrypoint.s…"   26 seconds ago   Up 24 seconds (healthy)   0.0.0.0:5432->5432/tcp, :::5432->5432/tcp                       postgres
```

#### 2. Создаем "postgresql" коннектор в Debezium:
```console
# make connector-create

curl -s -X POST -d @debezium/connector.json -H "Content-Type: application/json" "http://localhost:8083/connectors" | jq
{
  "name": "postgres-otus-source",
  "config": {
    "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
    "database.dbname": "otus",
    "database.hostname": "postgres",
    "database.port": "5432",
    "database.user": "postgres",
    "database.password": "postgres",
    "plugin.name": "pgoutput",
    "table.include.list": "public.customers",
    "tasks.max": "1",
    "topic.prefix": "postgres",
    "topic.creation.enable": "true",
    "topic.creation.default.replication.factor": "3",
    "topic.creation.default.partitions": "1",
    "topic.creation.default.cleanup.policy": "delete",
    "topic.creation.default.retention.ms": "604800000",
    "slot.name": "debezium",
    "name": "postgres-otus-source"
  },
  "tasks": [],
  "type": "source"
}
```

  Проверяем статус созданного коннектора:
```console
# make connector-status

curl -s -X GET "http://localhost:8083/connectors/postgres-otus-source/status" | jq
{
  "name": "postgres-otus-source",
  "connector": {
    "state": "RUNNING",
    "worker_id": "192.168.160.7:8083"
  },
  "tasks": [
    {
      "id": 0,
      "state": "RUNNING",
      "worker_id": "192.168.160.7:8083"
    }
  ],
  "type": "source"
}
```

#### 3. Загружаем данные в таблицу "customers":
```console
# make load

docker exec -it postgres psql -U postgres -d otus \
    -c "WITH data AS (SELECT generate_series(1, 20) i) INSERT INTO customers(name) SELECT format('name-%s', i) FROM data;"
INSERT 0 20
```


#### 4. Загружаем данные в таблицу "customers":
```console
# make list-topics

docker exec -it kafka1 /bin/kafka-topics --list --bootstrap-server=kafka1:9092
__consumer_offsets
debezium-connect-configs
debezium-connect-offsets
debezium-connect-statuses
postgres.public.customers
```


#### 5. Проверяем содержимое топика "postgres.public.customers" в кафке:
```console
# make list-customers

docker exec -it kafka1 /bin/kafka-console-consumer --bootstrap-server=kafka1:9092 --topic=postgres.public.customers --from-beginning --timeout-ms=1000
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":1,"name":"name-1"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26584544\"]","schema":"public","table":"customers","txId":746,"lsn":26584544,"xmin":null},"op":"c","ts_ms":1717518759691,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":2,"name":"name-2"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26584776\"]","schema":"public","table":"customers","txId":746,"lsn":26584776,"xmin":null},"op":"c","ts_ms":1717518759694,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":3,"name":"name-3"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26584912\"]","schema":"public","table":"customers","txId":746,"lsn":26584912,"xmin":null},"op":"c","ts_ms":1717518759694,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":4,"name":"name-4"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26585048\"]","schema":"public","table":"customers","txId":746,"lsn":26585048,"xmin":null},"op":"c","ts_ms":1717518759695,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":5,"name":"name-5"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26585184\"]","schema":"public","table":"customers","txId":746,"lsn":26585184,"xmin":null},"op":"c","ts_ms":1717518759695,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":6,"name":"name-6"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26585320\"]","schema":"public","table":"customers","txId":746,"lsn":26585320,"xmin":null},"op":"c","ts_ms":1717518759695,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":7,"name":"name-7"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26585456\"]","schema":"public","table":"customers","txId":746,"lsn":26585456,"xmin":null},"op":"c","ts_ms":1717518759695,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":8,"name":"name-8"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26585592\"]","schema":"public","table":"customers","txId":746,"lsn":26585592,"xmin":null},"op":"c","ts_ms":1717518759695,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":9,"name":"name-9"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26585728\"]","schema":"public","table":"customers","txId":746,"lsn":26585728,"xmin":null},"op":"c","ts_ms":1717518759696,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":10,"name":"name-10"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26585864\"]","schema":"public","table":"customers","txId":746,"lsn":26585864,"xmin":null},"op":"c","ts_ms":1717518759696,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":11,"name":"name-11"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26586000\"]","schema":"public","table":"customers","txId":746,"lsn":26586000,"xmin":null},"op":"c","ts_ms":1717518759696,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":12,"name":"name-12"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26586136\"]","schema":"public","table":"customers","txId":746,"lsn":26586136,"xmin":null},"op":"c","ts_ms":1717518759696,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":13,"name":"name-13"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26586272\"]","schema":"public","table":"customers","txId":746,"lsn":26586272,"xmin":null},"op":"c","ts_ms":1717518759696,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":14,"name":"name-14"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26586408\"]","schema":"public","table":"customers","txId":746,"lsn":26586408,"xmin":null},"op":"c","ts_ms":1717518759697,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":15,"name":"name-15"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26586544\"]","schema":"public","table":"customers","txId":746,"lsn":26586544,"xmin":null},"op":"c","ts_ms":1717518759697,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":16,"name":"name-16"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26586680\"]","schema":"public","table":"customers","txId":746,"lsn":26586680,"xmin":null},"op":"c","ts_ms":1717518759697,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":17,"name":"name-17"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26586816\"]","schema":"public","table":"customers","txId":746,"lsn":26586816,"xmin":null},"op":"c","ts_ms":1717518759697,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":18,"name":"name-18"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26586952\"]","schema":"public","table":"customers","txId":746,"lsn":26586952,"xmin":null},"op":"c","ts_ms":1717518759697,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":19,"name":"name-19"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26587088\"]","schema":"public","table":"customers","txId":746,"lsn":26587088,"xmin":null},"op":"c","ts_ms":1717518759698,"transaction":null}}
{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"default":0,"field":"id"},{"type":"string","optional":false,"field":"name"}],"optional":true,"name":"postgres.public.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false,incremental"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":true,"field":"sequence"},{"type":"string","optional":false,"field":"schema"},{"type":"string","optional":false,"field":"table"},{"type":"int64","optional":true,"field":"txId"},{"type":"int64","optional":true,"field":"lsn"},{"type":"int64","optional":true,"field":"xmin"}],"optional":false,"name":"io.debezium.connector.postgresql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"},{"type":"int64","optional":false,"field":"total_order"},{"type":"int64","optional":false,"field":"data_collection_order"}],"optional":true,"name":"event.block","version":1,"field":"transaction"}],"optional":false,"name":"postgres.public.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":20,"name":"name-20"},"source":{"version":"2.5.4.Final","connector":"postgresql","name":"postgres","ts_ms":1717518759231,"snapshot":"false","db":"otus","sequence":"[null,\"26587224\"]","schema":"public","table":"customers","txId":746,"lsn":26587224,"xmin":null},"op":"c","ts_ms":1717518759698,"transaction":null}}
[2024-06-04 17:23:24,542] ERROR Error processing message, terminating consumer process:  (kafka.tools.ConsoleConsumer$)
org.apache.kafka.common.errors.TimeoutException
Processed a total of 20 messages
```


#### 6. Скриншоты "kafdrop" сохранены в директорию "./images"
